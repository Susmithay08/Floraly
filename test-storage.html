<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStorage Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 40px;
            background: #f0f0f0;
        }

        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #333;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            margin: 10px 5px;
            cursor: pointer;
            border-radius: 5px;
            border: 2px solid #333;
            background: #4CAF50;
            color: white;
        }

        button:hover {
            background: #45a049;
        }

        .clear-btn {
            background: #f44336;
        }

        .clear-btn:hover {
            background: #da190b;
        }

        #output {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            min-height: 100px;
            font-size: 14px;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>üîç LocalStorage Diagnostic Test</h1>

    <div class="test-box">
        <h2>Step 1: Test Basic Storage</h2>
        <button onclick="testBasic()">Test Basic Storage</button>
        <button onclick="testFlowerData()">Save Test Flower Data</button>
        <button class="clear-btn" onclick="clearStorage()">Clear All Storage</button>
    </div>

    <div class="test-box">
        <h2>Step 2: Check Current Storage</h2>
        <button onclick="checkStorage()">Check What's Stored</button>
        <button onclick="viewAllKeys()">View All Keys</button>
    </div>

    <div class="test-box">
        <h2>Step 3: Navigate Test</h2>
        <p>After saving test data, click below to go to customize.html:</p>
        <button onclick="goToCustomize()">Go to Customize Page</button>
    </div>

    <div id="output">Waiting for test...</div>

    <script>
        const output = document.getElementById('output');

        function log(msg) {
            output.innerHTML += msg + '\n';
            console.log(msg);
        }

        function clearOutput() {
            output.innerHTML = '';
        }

        function testBasic() {
            clearOutput();
            log('üß™ Testing basic localStorage...\n');

            try {
                // Test 1: Simple string
                localStorage.setItem('test1', 'Hello');
                const test1 = localStorage.getItem('test1');
                log('‚úÖ Test 1 (string): ' + test1);

                // Test 2: JSON object
                const testObj = { name: 'Rose', count: 3 };
                localStorage.setItem('test2', JSON.stringify(testObj));
                const test2 = JSON.parse(localStorage.getItem('test2'));
                log('‚úÖ Test 2 (JSON): ' + JSON.stringify(test2));

                // Test 3: Check if it persists
                log('\n‚úÖ localStorage is working!');
                log('Total items: ' + localStorage.length);

            } catch (e) {
                log('‚ùå ERROR: ' + e.message);
                log('\nLocalStorage might be disabled in your browser.');
            }
        }

        function testFlowerData() {
            clearOutput();
            log('üå∏ Saving test flower data...\n');

            const testFlowers = {
                "rose": 2,
                "lily": 1,
                "sunflower": 3
            };

            try {
                localStorage.setItem('selectedFlowers', JSON.stringify(testFlowers));
                log('‚úÖ Saved: ' + JSON.stringify(testFlowers));

                // Read it back
                const retrieved = localStorage.getItem('selectedFlowers');
                log('‚úÖ Retrieved: ' + retrieved);

                const parsed = JSON.parse(retrieved);
                log('‚úÖ Parsed: ' + JSON.stringify(parsed));
                log('\nüéâ Test flower data saved successfully!');
                log('\nNow click "Go to Customize Page" to test navigation.');

            } catch (e) {
                log('‚ùå ERROR: ' + e.message);
            }
        }

        function checkStorage() {
            clearOutput();
            log('üìã Checking selectedFlowers key...\n');

            const data = localStorage.getItem('selectedFlowers');

            if (data) {
                log('Raw data: ' + data);
                log('Type: ' + typeof data);
                log('Length: ' + data.length);

                try {
                    const parsed = JSON.parse(data);
                    log('\nParsed successfully!');
                    log('Type: ' + typeof parsed);
                    log('Is Array: ' + Array.isArray(parsed));
                    log('Keys: ' + Object.keys(parsed).join(', '));
                    log('Values: ' + Object.values(parsed).join(', '));

                    log('\nüìä Full object:');
                    log(JSON.stringify(parsed, null, 2));
                } catch (e) {
                    log('‚ùå Parse error: ' + e.message);
                }
            } else {
                log('‚ùå No data found for "selectedFlowers"');
            }
        }

        function viewAllKeys() {
            clearOutput();
            log('üîë All localStorage keys:\n');

            if (localStorage.length === 0) {
                log('‚ùå LocalStorage is empty');
            } else {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);
                    log(`Key ${i}: "${key}"`);
                    log(`Value: ${value.substring(0, 100)}${value.length > 100 ? '...' : ''}\n`);
                }
            }
        }

        function clearStorage() {
            clearOutput();
            log('üóëÔ∏è Clearing all localStorage...\n');
            localStorage.clear();
            log('‚úÖ Cleared!');
            log('Items remaining: ' + localStorage.length);
        }

        function goToCustomize() {
            log('üöÄ Navigating to customize.html...');
            log('Current storage: ' + localStorage.getItem('selectedFlowers'));
            window.location.href = 'customize.html';
        }

        // Auto-check on load
        window.addEventListener('load', function () {
            log('üå∏ Page loaded\n');
            log('Browser: ' + navigator.userAgent.substring(0, 50) + '...');
            log('LocalStorage available: ' + (typeof Storage !== 'undefined'));
            log('\nClick a button above to test!\n');
        });
    </script>
</body>

</html>