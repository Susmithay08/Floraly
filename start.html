<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floraly - Digital Bouquet Builder</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tangerine:wght@700&family=Macondo&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            overflow: hidden;
            height: 100vh;
        }

        body {
            font-family: 'Macondo', cursive;
            background-image: url('./Images/bg.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* Hide scrollbar */
        body::-webkit-scrollbar {
            display: none;
        }

        body {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .container {
            position: relative;
            width: 100%;
            height: 100vh;
        }

        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background: transparent !important;
            /* Add this line */
            pointer-events: none;
            /* Add this to allow clicks through */
        }

        .content-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px;
            pointer-events: none;
            z-index: 2;
            animation: fadeIn 1.2s ease-in;
        }

        .content-overlay>* {
            pointer-events: auto;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Tangerine', cursive;
            font-size: clamp(80px, 15vw, 180px);
            color: #000000;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
            animation: floatIn 1.5s ease-out;
            letter-spacing: 1px;
        }

        @keyframes floatIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tagline {
            font-size: clamp(18px, 3vw, 28px);
            color: #000000;
            margin-bottom: 10px;
            animation: fadeIn 1.5s ease-in 0.3s backwards;
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.8);
        }

        .subtitle {
            font-size: clamp(16px, 2.5vw, 24px);
            color: #000000;
            margin-bottom: 50px;
            animation: fadeIn 1.8s ease-in 0.5s backwards;
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.7);
        }

        .design-button {
            display: inline-block;
            padding: 20px 50px;
            font-family: 'Macondo', cursive;
            font-size: clamp(20px, 3vw, 28px);
            color: #000000;
            background: rgba(238, 144, 189, 0.3);
            border: 2px solid rgba(238, 144, 207, 0.5);
            border-radius: 50px;
            text-decoration: none;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(238, 144, 230, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: fadeIn 2s ease-in 0.7s backwards;
            position: relative;
            overflow: hidden;
        }

        .design-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .design-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .design-button:hover {
            transform: translateY(-5px);
            background: rgba(144, 238, 144, 0.4);
            box-shadow: 0 12px 40px 0 rgba(144, 238, 144, 0.3);
            border-color: rgba(144, 238, 144, 0.7);
        }

        .design-button:active {
            transform: translateY(-2px);
        }

        .fun-text {
            font-size: clamp(14px, 2vw, 20px);
            color: #000000;
            margin-top: 40px;
            animation: fadeIn 2.3s ease-in 1s backwards;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.9);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .content-overlay {
                padding: 20px;
            }

            .design-button {
                padding: 15px 35px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <canvas id="canvas"></canvas>

        <div class="content-overlay">
            <h1>Floraly</h1>
            <p class="tagline">Build your own bouquet</p>
            <p class="subtitle">and send them virtually</p>

            <a href="build.html" class="design-button">
                <span>Design Here</span>
            </a>

            <p class="fun-text">While you decide, Click to add flowers</p>
        </div>
    </div>

    <script type="x-shader/x-fragment" id="fragmentShader">
        uniform float u_ratio;
        uniform vec2 u_point;
        uniform float u_time;
        uniform float u_stop_time;
        uniform vec3 u_stop_randomizer;
        uniform sampler2D u_texture;
        uniform vec3 u_background_color;

        varying vec2 vUv;

        #define PI 3.14159265359

        vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
        vec3 permute(vec3 x) { return mod289(((x * 34.0) + 1.0) * x); }
        float snoise(vec2 v) {
            const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);
            vec2 i = floor(v + dot(v, C.yy));
            vec2 x0 = v - i + dot(i, C.xx);
            vec2 i1;
            i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
            vec4 x12 = x0.xyxy + C.xxzz;
            x12.xy -= i1;
            i = mod289(i);
            vec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));
            vec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);
            m = m * m;
            m = m * m;
            vec3 x = 2.0 * fract(p * C.www) - 1.0;
            vec3 h = abs(x) - 0.5;
            vec3 ox = floor(x + 0.5);
            vec3 a0 = x - ox;
            m *= 1.79284291400159 - 0.85373472095314 * (a0 * a0 + h * h);
            vec3 g;
            g.x = a0.x * x0.x + h.x * x0.y;
            g.yz = a0.yz * x12.xz + h.yz * x12.yw;
            return 130.0 * dot(m, g);
        }

        float get_dot_shape(vec2 dist, float radius_max, float radius_line) {
            return 1. - smoothstep(radius_line * radius_max, radius_max, dot(dist, dist) * 4.0);
        }

        
        float get_stem_shape(vec2 _cursor, vec2 _uv, float _t, float _size, float _flowery, vec2 _rand) {

            float stroke_width = .01;
            float noise_power = .2;

            float cursor_horizontal_noise = noise_power * (1. + (1. - _flowery)) * snoise(3. * _uv * (_rand - .5));

            cursor_horizontal_noise *= pow(dot(_cursor.y, _cursor.y), .3 * _flowery);
            cursor_horizontal_noise *= pow(dot(_uv.y, _uv.y), .3);
            _cursor.x += cursor_horizontal_noise;

            _cursor.y *= (1. - ((1. - _flowery) * .7));
            _cursor.y += ((1. - _flowery) * .7 * _rand.x);

            stroke_width = (1. - _flowery) * .9 * pow(dot(_uv.y, _cursor.x), 1.) + _flowery * .03;
            stroke_width -= .02;

            float left = smoothstep(-stroke_width, 0., _cursor.x);
            float right = smoothstep(stroke_width, 0., _cursor.x);
            float stem_shape = left * right;

            float stem_top_mask = smoothstep(_cursor.y - .1, _cursor.y, min(-.1, _t - 1.));

            stem_shape *= stem_top_mask;
            stem_shape += .5 * get_dot_shape(_cursor + vec2(0., .02), .15 * _size, .5);
            stem_shape *= stem_top_mask;

            return stem_shape;
        }

        void main() {

            float speed = 1.3;
            float t = speed * u_stop_time;

            vec2 uv = vUv;
            uv += 0.00007 * snoise(vUv * 6.0 + vec2(0.0, 15.0 * cos(0.1 * u_time)));
            uv.y += 0.00005;

            vec3 color = texture2D(u_texture, uv).xyz;
            color += 0.0015 * u_background_color;

            vec2 cursor = uv - u_point.xy;
            cursor.x *= u_ratio;

            float base_radius = .02 + .2 * u_stop_randomizer.y;
            float grow_duration = .6;
            float grow_speed = 2. * speed;
            float bloom_duration = .3 * u_stop_randomizer.y;

            float is_open = step(.1, base_radius);

            if (t < grow_duration) {
                vec3 stem_color = u_background_color - normalize(vec3(.3, .5, .1));
                float stem_shape = get_stem_shape(cursor, uv, grow_speed * t, base_radius, 1., u_stop_randomizer.xy);
                stem_shape += get_stem_shape(cursor, uv, grow_speed * t, 0., 0., u_stop_randomizer.yz);
                stem_shape += get_stem_shape(cursor, uv, grow_speed * t, 0., 0., u_stop_randomizer.zy);
                vec3 stem = stem_shape * stem_color;
                color -= stem;
            }

            if (t < grow_duration + is_open * bloom_duration) {

                float blooming_time = max(0., pow(1.1 * t, 2.) - .05);
                float radius = base_radius * blooming_time;

                vec2 noisy_cursor = vUv - u_point.xy;
                noisy_cursor.x *= u_ratio;
                noisy_cursor.y *= (1. + u_stop_randomizer.y * is_open);
                noisy_cursor -= .02 * snoise(noisy_cursor * 10. + vec2(0., 10. * sin(.5 * t + PI)));

                vec3 flower_color = u_background_color;
                flower_color -= normalize(vec3(.5 + .5 * sin(2. * u_time), .3, .5 + .5 * sin(2. * u_time + PI)));
                color -= .4 * get_dot_shape(noisy_cursor, 1.5 * radius, .0) * flower_color;

                color = .7 * color + .3 * mix(u_background_color, color, 1. - get_dot_shape(noisy_cursor, radius, 0.));

                noisy_cursor.y -= .02;
                float inner_r = .7 * radius;
                float inner_w = .2 * radius;
                float ring_shape = get_dot_shape(noisy_cursor, inner_r + inner_w, .9) - get_dot_shape(noisy_cursor, inner_r, .9);
                color += .2 * blooming_time * ring_shape * step(.1, base_radius);

                inner_r = .4 * radius;
                inner_w = .1 * radius;
                ring_shape = get_dot_shape(noisy_cursor, inner_r + inner_w, .9) - get_dot_shape(noisy_cursor, inner_r, .9);
                color += .1 * pow(t, .5) * ring_shape * step(.1, base_radius);

                vec2 low_noise_cursor = vUv - u_point.xy;
                low_noise_cursor.x *= .5 * u_ratio;
                low_noise_cursor.y += .02;
                low_noise_cursor += .01 * snoise(low_noise_cursor * 10. + t);
                color -= is_open * pow(t, 5.) * get_dot_shape(low_noise_cursor, .01 * radius, 0.);
            }

            gl_FragColor = vec4(color, 1.0);
        }
    </script>

    <script type="x-shader/x-vertex" id="vertexShader">
        varying vec2 vUv;
        void main() {
            vUv = uv;
            gl_Position = vec4(position, 1.);
        }
    </script>

    <script type="module">
        import * as THREE from "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.151.0/three.module.js";

        const canvasEl = document.querySelector("#canvas");

        const pointer = {
            x: .65,
            y: .3,
            clicked: true
        };

        window.setTimeout(() => {
            pointer.x = .75;
            pointer.y = .5;
            pointer.clicked = true;
        }, 400);
        window.setTimeout(() => {
            pointer.x = .4;
            pointer.y = .5;
            pointer.clicked = true;
        }, 700);

        let isStart = true;

        let renderer, shaderScene, mainScene, renderTargets, camera, clock;
        let basicMaterial, shaderMaterial;

        const backgroundColor = new THREE.Color(0xffffff);

        initScene();
        updateSize();
        window.addEventListener("resize", updateSize);

        function handleClickOrTouch(e) {
            if (e.target.closest('.design-button')) {
                return;
            }

            e.preventDefault();

            let clientX, clientY;

            if (e.type === "click") {
                clientX = e.clientX;
                clientY = e.clientY;
            } else if (e.type === "touchstart") {
                const touch = e.touches[0];
                clientX = touch.clientX;
                clientY = touch.clientY;
            }

            pointer.x = clientX / window.innerWidth;
            pointer.y = clientY / window.innerHeight;
            pointer.clicked = true;
        }

        window.addEventListener("click", handleClickOrTouch);
        window.addEventListener("touchstart", handleClickOrTouch);

        render();

        function initScene() {
            renderer = new THREE.WebGLRenderer({
                canvas: canvasEl,
                alpha: true
            });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            shaderScene = new THREE.Scene();
            mainScene = new THREE.Scene();

            camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);
            clock = new THREE.Clock();

            renderTargets = [
                new THREE.WebGLRenderTarget(window.innerWidth, window.innerHeight),
                new THREE.WebGLRenderTarget(window.innerWidth, window.innerHeight),
            ];

            const planeGeometry = new THREE.PlaneGeometry(2, 2);

            shaderMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    u_ratio: { type: "f", value: window.innerWidth / window.innerHeight },
                    u_point: { type: "v2", value: new THREE.Vector2(pointer.x, pointer.y) },
                    u_time: { type: "f", value: 0. },
                    u_stop_time: { type: "f", value: 0. },
                    u_stop_randomizer: { type: "v3", value: new THREE.Vector2(0, 0, 0) },
                    u_texture: { type: "t", value: null },
                    u_background_color: { type: "v3", value: backgroundColor }
                },
                vertexShader: document.getElementById("vertexShader").textContent,
                fragmentShader: document.getElementById("fragmentShader").textContent,
                transparent: true
            });

            basicMaterial = new THREE.MeshBasicMaterial({
                transparent: true
            });

            const backgroundColorMaterial = new THREE.MeshBasicMaterial({
                color: backgroundColor,
                transparent: true
            });

            const planeBasic = new THREE.Mesh(planeGeometry, basicMaterial);
            const planeShader = new THREE.Mesh(planeGeometry, shaderMaterial);
            const coloredPlane = new THREE.Mesh(planeGeometry, backgroundColorMaterial);

            shaderScene.add(planeShader);
            mainScene.add(coloredPlane);

            renderer.setRenderTarget(renderTargets[0]);
            renderer.render(mainScene, camera);

            mainScene.remove(coloredPlane);
            mainScene.add(planeBasic);
        }

        function render() {
            requestAnimationFrame(render);
            const delta = clock.getDelta();

            shaderMaterial.uniforms.u_texture.value = renderTargets[0].texture;
            shaderMaterial.uniforms.u_time.value = clock.getElapsedTime() + .9;

            if (pointer.clicked) {
                shaderMaterial.uniforms.u_point.value = new THREE.Vector2(pointer.x, 1 - pointer.y);
                shaderMaterial.uniforms.u_stop_randomizer.value = new THREE.Vector3(Math.random(), Math.random(), Math.random());
                if (isStart) {
                    shaderMaterial.uniforms.u_stop_randomizer.value = new THREE.Vector3(.5, 1, 1);
                    isStart = false;
                }
                shaderMaterial.uniforms.u_stop_time.value = 0.;
                pointer.clicked = false;
            }
            shaderMaterial.uniforms.u_stop_time.value += delta;

            renderer.setRenderTarget(renderTargets[1]);
            renderer.render(shaderScene, camera);

            basicMaterial.map = renderTargets[1].texture;

            renderer.setRenderTarget(null);
            renderer.render(mainScene, camera);

            let tmp = renderTargets[0];
            renderTargets[0] = renderTargets[1];
            renderTargets[1] = tmp;
        }

        function updateSize() {
            shaderMaterial.uniforms.u_ratio.value = window.innerWidth / window.innerHeight;
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
    </script>
</body>

</html>